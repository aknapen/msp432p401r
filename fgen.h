/*
 * fgen.h
 *
 *  Created on: May 11, 2020
 *      Author: sdanthinne
 */

#ifndef FGEN_H_
#define FGEN_H_
#define MIN_OUT_RATE 7 //the minimum amount of time it takes to write out to the DAC. (in us)
#define SAMPLE_TIME (MIN_OUT_RATE + TIME_MARGIN)
#define TIME_MARGIN 63 //TODO: some margin of time to allow for errors. (in us) (currently experimentally set)
#define DCO_SPEED 24
#define TIMER_VALUE 320

#define INTERRUPT_FREQUENCY 56770

//types of waves that the wave gen supports. Allows us to do bitwise checks for active waves
#define SINE_WAVE 1
#define TRIANGLE_WAVE 2
#define SQUARE_WAVE 4
#define SAWTOOTH_WAVE 8

#define SQUARE_INDEX ((count % max_count)< ((INTERRUPT_FREQUENCY/(frequency)+1) *(duty_cycle)/10)) // Macro for calculating index into square wave array
        // Creates an adjust sq count normalized to a maximum determined by frequency of interrupts and square wave
        // checks to see if normalized square count is less than the maximum square count divided by duty cycle

void main_fg(void);

static const uint16_t square_wave[2] =  // Square wave LUT is seperate
{
     0,930
};

uint8_t wave_type;  //the type of the wave - refer to macros
uint8_t duty_cycle; //duty cycle of square wave (1-9 -> 10%->90%)
uint16_t frequency; //the frequency of the output wave in Hz
uint8_t is_ready;   //flag denoting when the mcu is ready to write a value to the DAC
uint8_t wave_count; // Count of how many waves are currently active

static const uint16_t waves_3v[9][512] =   // Array of LUT using macro values as indexes
{

 { // LUT of 0's allowing us to index and use LUT without any additional logic statements. Considerably speeding up operations
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0,0,0,0,0,0,0,
      0,0,0,0,0,0,0,0
 },


 {  //sine wave LUT
      465,471,476,482,488,494,499,505,511,516,
     522,528,533,539,544,550,556,561,567,572,
     578,584,589,595,600,605,611,616,622,627,
     632,638,643,648,653,659,664,669,674,679,
     684,689,694,699,704,709,714,719,723,728,
     733,737,742,747,751,756,760,764,769,773,
     777,781,786,790,794,798,802,806,810,813,
     817,821,824,828,832,835,838,842,845,848,
     852,855,858,861,864,867,870,872,875,878,
     880,883,885,888,890,892,895,897,899,901,
     903,905,907,908,910,912,913,915,916,917,
     919,920,921,922,923,924,925,926,927,927,
     928,928,929,929,929,930,930,930,930,930,
     930,930,929,929,929,928,928,927,927,926,
     925,924,923,922,921,920,919,917,916,915,
     913,912,910,908,907,905,903,901,899,897,
     895,892,890,888,885,883,880,878,875,872,
     870,867,864,861,858,855,852,848,845,842,
     838,835,832,828,824,821,817,813,810,806,
     802,798,794,790,786,781,777,773,769,764,
     760,756,751,747,742,737,733,728,723,719,
     714,709,704,699,694,689,684,679,674,669,
     664,659,653,648,643,638,632,627,622,616,
     611,605,600,595,589,584,578,572,567,561,
     556,550,544,539,533,528,522,516,511,505,
     499,494,488,482,476,471,465,459,454,448,
     442,436,431,425,419,414,408,402,397,391,
     386,380,374,369,363,358,352,346,341,335,
     330,325,319,314,308,303,298,292,287,282,
     277,271,266,261,256,251,246,241,236,231,
     226,221,216,211,207,202,197,193,188,183,
     179,174,170,166,161,157,153,149,144,140,
     136,132,128,124,120,117,113,109,106,102,
     98,95,92,88,85,82,78,75,72,69,
     66,63,60,58,55,52,50,47,45,42,
     40,38,35,33,31,29,27,25,23,22,
     20,18,17,15,14,13,11,10,9,8,
     7,6,5,4,3,3,2,2,1,1,
     1,0,0,0,0,0,0,0,1,1,
     1,2,2,3,3,4,5,6,7,8,
     9,10,11,13,14,15,17,18,20,22,
     23,25,27,29,31,33,35,38,40,42,
     45,47,50,52,55,58,60,63,66,69,
     72,75,78,82,85,88,92,95,98,102,
     106,109,113,117,120,124,128,132,136,140,
     144,149,153,157,161,166,170,174,179,183,
     188,193,197,202,207,211,216,221,226,231,
     236,241,246,251,256,261,266,271,277,282,
     287,292,298,303,308,314,319,325,330,335,
     341,346,352,358,363,369,374,380,386,391,
     397,402,408,414,419,425,431,436,442,448,
     454,459
 },

 {//triangle wave LUT
    4,7,11,15,18,22,25,29,33,36,
    40,44,47,51,54,58,62,65,69,73,
    76,80,84,87,91,94,98,102,105,109,
    113,116,120,124,127,131,134,138,142,145,
    149,153,156,160,163,167,171,174,178,182,
    185,189,193,196,200,203,207,211,214,218,
    222,225,229,233,236,240,243,247,251,254,
    258,262,265,269,272,276,280,283,287,291,
    294,298,302,305,309,312,316,320,323,327,
    331,334,338,341,345,349,352,356,360,363,
    367,371,374,378,381,385,389,392,396,400,
    403,407,411,414,418,421,425,429,432,436,
    440,443,447,450,454,458,461,465,469,472,
    476,480,483,487,490,494,498,501,505,509,
    512,516,519,523,527,530,534,538,541,545,
    549,552,556,559,563,567,570,574,578,581,
    585,589,592,596,599,603,607,610,614,618,
    621,625,628,632,636,639,643,647,650,654,
    658,661,665,668,672,676,679,683,687,690,
    694,698,701,705,708,712,716,719,723,727,
    730,734,737,741,745,748,752,756,759,763,
    767,770,774,777,781,785,788,792,796,799,
    803,806,810,814,817,821,825,828,832,836,
    839,843,846,850,854,857,861,865,868,872,
    876,879,883,886,890,894,897,901,905,908,
    912,915,919,923,926,930,926,923,919,915,
    912,908,905,901,897,894,890,886,883,879,
    876,872,868,865,861,857,854,850,846,843,
    839,836,832,828,825,821,817,814,810,806,
    803,799,796,792,788,785,781,777,774,770,
    767,763,759,756,752,748,745,741,737,734,
    730,727,723,719,716,712,708,705,701,698,
    694,690,687,683,679,676,672,668,665,661,
    658,654,650,647,643,639,636,632,628,625,
    621,618,614,610,607,603,599,596,592,589,
    585,581,578,574,570,567,563,559,556,552,
    549,545,541,538,534,530,527,523,519,516,
    512,509,505,501,498,494,490,487,483,480,
    476,472,469,465,461,458,454,450,447,443,
    440,436,432,429,425,421,418,414,411,407,
    403,400,396,392,389,385,381,378,374,371,
    367,363,360,356,352,349,345,341,338,334,
    331,327,323,320,316,312,309,305,302,298,
    294,291,287,283,280,276,272,269,265,262,
    258,254,251,247,243,240,236,233,229,225,
    222,218,214,211,207,203,200,196,193,189,
    185,182,178,174,171,167,163,160,156,153,
    149,145,142,138,134,131,127,124,120,116,
    113,109,105,102,98,94,91,87,84,80,
    76,73,69,65,62,58,54,51,47,44,
    40,36,33,29,25,22,18,15,11,7,
    4,0
 },
 {},

{ // Square Wave LUT
  0,930
},

{},
{},
{},

{   //Sawtooth wave LUT
     0,2,4,5,7,9,11,13,15,16,18,20,22,
     24,25,27,29,31,33,35,36, 38,40,42,
     44,45,47,49,51,53,54,56,58,60,62,64,
     65,67,69,71, 73,74,76,78,80,82,84,85,
     87,89,91,93,94,96,98,100,102,104, 105,
     107,109,111,113,114,116,118,120,122,
     124,125,127,129, 131,133,134,136,138,
     140,142,143,145,147,149,151,153,154,156,
     158,160,162,163,165,167,169,171,173,174,
     176,178,180,182,183,185, 187,189,191,193,
     194,196,198,200,202,203,205,207,209,211,
     213,214, 216,218,220,222,223,225,227,229,
     231,233,234,236,238,240,242,243, 245,247,
     249,251,252,254,256,258,260,262,263,265,267,
     269,271,272, 274,276,278,280,282,283,285,287,
     289,291,292,294,296,298,300,302, 303,305,307,
     309,311,312,314,316,318,320,322,323,325,327,
     329,331, 332,334,336,338,340,341,343,345,347,
     349,351,352,354,356,358,360,361,363,365,367,
     369,371,372,374,376,378,380,381,383,385,387,
     389,391, 392,394,396,398,400,401,403,405,407,
     409,411,412,414,416,418,420,421, 423,425,427,
     429,430,432,434,436,438,440,441,443,445,447,
     449,450,452,454, 456,458,460,461,463,465,467,
     469,470,472,474,476,478,480,481,483,485,487,
     489,490,492,494,496,498,500,501,503,505,507,
     509,510,512,514,516,518,519, 521,523,525,527,
     529,530,532,534,536,538,539,541,543,545,547,
     549,550,552, 554,556,558,559,561,563,565,567,
     569,570,572,574,576,578,579,581,583,585,587,589,
     590,592,594,596,598,599,601,603,605,607,608,
     610,612,614,616,618, 619,621,623,625,627,628,
     630,632,634,636,638,639,641,643,645,647,648,650,
     652,654,656,658,659,661,663,665,667,668,670,
     672,674,676,678,679,681,683,685,687,688,690,
     692,694,696,698,699,701,703,705,707,708,710,
     712,714,716,717,719,721,723,725,727,728,730,
     732,734,736,737,739,741,743,745,747,748,750,
     752,754,756,757,759,761,763,765,767,768,770,
     772,774,776,777,779,781,783,785,787,788,790,
     792,794,796,797,799,801,803,805,806,808,810,
     812,814,816,817,819,821,823,825,826,828,830,
     832,834,836,837,839,841,843,845,846,848,850,
     852,854,856,857,859,861,863,865,866,868,870,
     872,874,876,877,879,881,883,885,886,888,890,
     892,894,895,897,899,901,903,905,906,908,910,
     912,914,915,917,919,921,923,925,926,928
}
};
#endif /* FGEN_H_ */
